<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chomolungma.system.role.domain.repository.mapper.RoleMapper">
    <insert id="insertRolePermission" parameterType="com.chomolungma.system.role.domain.repository.dataobject.RolePermissionDO">
        insert into sys_role_menu
        (role_id, menu_id, is_half_key)
        VALUES
        <foreach collection ="rolePermissionDO.permissions" item="item" separator =",">
            (#{rolePermissionDO.roleId}, #{item.menuId}, #{item.isHalfKey})
        </foreach >
    </insert>

    <delete id="deletePermissionByRoleId">
        delete from sys_role_menu where role_id = #{roleId, jdbcType=BIGINT}
    </delete>

    <select id="selectMenusByRoleIds" resultType="com.chomolungma.system.menu.domain.repository.dataobject.MenuDO">
        select sm.* from sys_role_menu srm
            left join sys_menu sm on srm.menu_id = sm.id
        <where>
            role_id in
            <foreach collection="list" item="roleId" index="index" open="(" close=")" separator=",">
                #{roleId}
            </foreach>
        </where>
        group by srm.menu_id order by sm.sort
    </select>


    <select id="selectMenusByRoleId" resultType="com.chomolungma.system.role.interfaces.dto.RoleMenuDTO">
        select menu_id, is_half_key from sys_role_menu
        <where>
            is_half_key = 0 and
            role_id = #{roleId, jdbcType=BIGINT}
        </where>
    </select>
</mapper>